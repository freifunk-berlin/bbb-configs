#jinja2: trim_blocks: True, lstrip_blocks: True
{% import 'libraries/network.j2' as libnetwork with context %}

{% if 'qos-scripts' in packages %}
config classify
	option target 'Priority'
	option ports '22,53'
	option comment 'ssh, dns'

config classify
	option target 'Normal'
	option proto 'tcp'
	option ports '20,21,25,80,110,443,993,995'
	option comment 'ftp, smtp, http(s), imap'

config classify
	option target 'Express'
	option ports '5190'
	option comment 'AOL, iChat, ICQ'

config default
	option target 'Express'
	option proto 'udp'
	option pktsize '-500'

config reclassify
	option target 'Priority'
	option proto 'icmp'

config default
	option target 'Bulk'
	option portrange '1024-65535'

config classgroup 'Default'
	option classes 'Priority Express Normal Bulk'
	option default 'Normal'

config class 'Priority'
	option packetsize '400'
	option avgrate '10'
	option priority '20'

config class 'Priority_down'
	option packetsize '1000'
	option avgrate '10'

config class 'Express'
	option packetsize '1000'
	option avgrate '50'
	option priority '10'

config class 'Normal'
	option packetsize '1500'
	option packetdelay '100'
	option avgrate '10'
	option priority '5'

config class 'Normal_down'
	option avgrate '20'

config class 'Bulk'
	option avgrate '1'
	option packetdelay '200'

  {% for network in networks %}
    {% if network['ingress'] is defined or network['egress'] is defined %}
      {% set name = libnetwork.getUciIfname(network) %}
config interface '{{ name }}'
	option enabled '1'
	option classgroup 'Default'
      {% if network['ingress'] is defined %}
	option download '{{ network['ingress'] }}000'
      {% endif %}
      {% if network['egress'] is defined %}
	option upload '{{ network['egress'] }}000'
      {% endif %}
    {% endif %}

  {% endfor %}
{% endif %}


